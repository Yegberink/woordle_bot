<!DOCTYPE html>
<html>
<head>
    <title>Wordle Helper</title>
    <style>
        .guess-history {
            margin-top: 20px;
        }
        .letter-box {
            display: inline-block;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            margin: 2px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            border-radius: 5px;
        }
        .green { background-color: #6aaa64; }
        .yellow { background-color: #c9b458; }
        .gray { background-color: #787c7e; }
    </style>
</head>
<body>
    <h1>Wordle Helper</h1>

    <form id="guess-form">
        <label for="guess">Guess:</label>
        <input type="text" id="guess" name="guess" maxlength="5" required>
        <label for="feedback">Feedback (GYB):</label>
        <input type="text" id="feedback" name="feedback" maxlength="5" required>
        <button type="submit">Submit</button>
        <button type="button" id="reset">Reset</button>
    </form>

    <h2>Next Suggestion</h2>
    <div id="suggestion"></div>

    <h2>Remaining Words: <span id="remaining-count"></span></h2>
    <ul id="remaining-list"></ul>

    <div class="guess-history" id="guess-history">
        <h2>History</h2>
    </div>

    <script>
        document.getElementById("guess-form").addEventListener("submit", async function(event) {
            event.preventDefault();
            const guess = document.getElementById("guess").value;
            const feedback = document.getElementById("feedback").value;

            const formData = new FormData();
            formData.append("guess", guess);
            formData.append("feedback", feedback);

            const response = await fetch("/next", {
                method: "POST",
                body: formData
            });

            const data = await response.json();
            updateUI(data);
        });

        document.getElementById("reset").addEventListener("click", async function() {
            await fetch("/reset", { method: "POST" });
            document.getElementById("suggestion").innerText = "";
            document.getElementById("remaining-list").innerHTML = "";
            document.getElementById("guess-history").innerHTML = "<h2>History</h2>";
            document.getElementById("remaining-count").innerText = "";
        });

        function updateUI(data) {
            const suggestionDiv = document.getElementById("suggestion");
            suggestionDiv.innerText = data.guess ? `Best guess: ${data.guess}` : "No suggestions.";

            const list = document.getElementById("remaining-list");
            list.innerHTML = "";
            data.remaining.forEach(word => {
                const li = document.createElement("li");
                li.textContent = word;
                list.appendChild(li);
            });

            document.getElementById("remaining-count").innerText = data.count;

            const historyDiv = document.getElementById("guess-history");
            historyDiv.innerHTML = "<h2>History</h2>";
            data.history.forEach(entry => {
                const row = document.createElement("div");
                for (let i = 0; i < 5; i++) {
                    const box = document.createElement("div");
                    box.className = "letter-box";
                    const fb = entry.feedback[i];
                    if (fb === "G") box.classList.add("green");
                    else if (fb === "Y") box.classList.add("yellow");
                    else box.classList.add("gray");

                    box.textContent = entry.guess[i].toUpperCase();
                    row.appendChild(box);
                }
                historyDiv.appendChild(row);
            });
        }
    </script>
</body>
</html>
